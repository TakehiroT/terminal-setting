# セキュリティルール

## 秘密情報の管理

- **絶対にハードコードしない**: APIキー、パスワード、トークン、秘密鍵などをソースコードに直接記述しない
- **環境変数を使用**: `.env`ファイルまたはシステム環境変数で管理
- **秘密管理サービス**: AWS Secrets Manager、HashiCorp Vault、GitHub Secretsなどを活用
- **`.gitignore`に追加**: `.env`、`credentials.json`などを必ずignore

## 入力値の検証

- **すべての外部入力を検証**: ユーザー入力、APIリクエスト、ファイルアップロード
- **型チェック**: TypeScriptの型システムを活用
- **バリデーションライブラリ**: Zod、Yup、Joi などを使用
- **ホワイトリスト方式**: 許可するパターンを明示的に定義

## 脆弱性対策

### SQLインジェクション
- プリペアドステートメントまたはORMを使用
- 生のSQLクエリは避ける
- ユーザー入力を直接クエリに埋め込まない

### XSS（クロスサイトスクリプティング）
- HTMLエスケープ処理を必須化
- Content-Security-Policy (CSP) ヘッダーを設定
- DOMベースXSSにも注意

### CSRF（クロスサイトリクエストフォージェリ）
- CSRFトークンを実装
- SameSite Cookie属性を設定
- Origin/Refererヘッダーの検証

## 依存関係の管理

- **定期的な脆弱性チェック**: `npm audit`、`pnpm audit`を実行
- **自動更新ツール**: Dependabot、Renovate Botを活用
- **最小権限の原則**: 必要最小限のパッケージのみをインストール

## 認証・認可

- **パスワードハッシュ化**: bcrypt、Argon2などを使用
- **JWT管理**: 適切な有効期限とリフレッシュトークン戦略
- **多要素認証（MFA）**: 可能な限り実装
- **セッション管理**: セキュアなセッションIDとタイムアウト設定

## データ保護

- **HTTPS必須**: すべての通信を暗号化
- **個人情報の暗号化**: データベース保存時も暗号化を検討
- **ログに秘密情報を出力しない**: パスワード、トークンなどは絶対にログに残さない

## エラーハンドリング

- **詳細なエラーメッセージを避ける**: 本番環境では内部構造を露出しない
- **適切なHTTPステータスコード**: 4xx、5xxを正しく使い分ける
- **エラーログの分離**: セキュリティ関連のログは別途管理
